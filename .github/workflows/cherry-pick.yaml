name: Cherry-pick to ddg_140

on:
  pull_request:
    types: [closed]
    branches:
      - master # Adjust this to your default branch if different


jobs:
  cherry-pick:
    # Only run if the PR was merged (not just closed)
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      pull-requests: write
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for cherry-picking
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Show GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"
        
      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          
      - name: Create cherry-pick branch
        id: create-branch
        run: |
          # Fetch the target branch
          git fetch origin ddg_140:ddg_140
          
          # Create a unique branch name for the cherry-pick
          BRANCH_NAME="cherry-pick-pr-${{ github.event.pull_request.number }}-to-ddg_140"
          echo "branch_name=${BRANCH_NAME}" >> $GITHUB_OUTPUT
          
          # Create and checkout the new branch from ddg_140
          git checkout -b ${BRANCH_NAME} ddg_140
          
      - name: Cherry-pick the merged commit
        id: cherry-pick
        run: |
          # Get the merge commit SHA
          MERGE_COMMIT="${{ github.sha }}"

          git cherry-pick ${MERGE_COMMIT}
          git push
          